FROM docker.io/i386/alpine:latest

# Set the hostname
RUN echo "alpinex11" > /etc/hostname

# Install required packages
RUN echo -e "\n@edge https://dl-cdn.alpinelinux.org/alpine/edge/main" >> /etc/apk/repositories
RUN echo -e "\n@edge https://dl-cdn.alpinelinux.org/alpine/edge/community" >> /etc/apk/repositories
RUN echo -e "\n@testing https://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories

RUN apk update && apk add alpine-base udev-init-scripts udev-init-scripts-openrc eudev xorg-server xf86-input-libinput font-dejavu xrandr xev bash xauth icewm
# RUN apk add dbus 
# Setup the init script
RUN rc-update add bootmisc boot && rc-update add udev sysinit && rc-update add udev-trigger sysinit && rc-update add udev-settle sysinit && rc-update add udev-postmount default
# RUN rc-update add dbus default

RUN chmod u+s /bin/login

# Add a user
RUN adduser -D -s /bin/bash user && echo 'user:' | chpasswd

# Allow root login
RUN echo 'root:root' | chpasswd

# Add a script to support display autoresizing
COPY --chown=user:user ./scripts/x11setscr.sh /etc/X11/xinit/xinitrc.d/99-x11setscr.sh

# terminal apps
RUN apk add vim python3 nodejs gcc nano openssh
# gui apps
RUN apk add gvim gedit xterm pcmanfm thunar

# config folder
# COPY --chown=user:user ./config /home/user/.config

# CMD [ "/bin/sh" ]
CMD [ "/sbin/init" ]
